<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ì‹¬ ë„ì„œ í˜ì´ì§€</title>
    <link rel="stylesheet" href="interest.css">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const booksPerPage = 5;
            let currentPage = 1;
            let bookData = [];
    
            document.querySelector(".logo").addEventListener("click", function () {
                window.location.href = "main.php";
            });
    
            document.querySelector(".mypage").addEventListener("click", function () {
                window.location.href = "mypage.php";
            });
    
            function fetchInterestBooks() {
                fetch("get_interest.php")
                    .then(response => response.json())
                    .then(data => {
                        bookData = data;
                        currentPage = 1; // ë°ì´í„°ë¥¼ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ë©´ ì²« í˜ì´ì§€ë¡œ ì´ˆê¸°í™”
                        renderBooks(currentPage);
                        renderPagination(); // í˜ì´ì§€ë„¤ì´ì…˜ë„ ì—…ë°ì´íŠ¸
                    })
                    .catch(error => console.error("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error));
            }
    
            function renderPagination() {
            const paginationContainer = document.querySelector(".table-container .pagination");
            paginationContainer.innerHTML = "";
            const totalPages = Math.ceil(bookData.length / booksPerPage);

            if (totalPages <= 1) return; // 1í˜ì´ì§€ë°–ì— ì—†ìœ¼ë©´ ìˆ¨ê¹€

            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement("span");
                pageBtn.innerText = i;
                pageBtn.classList.add("page-btn");
                if (i === currentPage) pageBtn.classList.add("active");

                pageBtn.addEventListener("click", function () {
                    currentPage = i;
                    renderBooks(currentPage);
                });

                paginationContainer.appendChild(pageBtn);

                if (i < totalPages) {
                    const separator = document.createElement("span");
                    separator.innerText = " | ";
                    paginationContainer.appendChild(separator);
                }
            }
        }

    
            function renderBooks(page) {
                const tbody = document.querySelector(".table-container tbody");
                tbody.innerHTML = "";
    
                const start = (page - 1) * booksPerPage;
                const end = start + booksPerPage;
                bookData.slice(start, end).forEach(book => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${book.title}</td>
                        <td>${book.author} / ${book.publisher}</td>
                        <td><button class="remove-btn" data-book-id="${book.id}">âŒ</button></td>
                    `;
                    tbody.appendChild(row);
                });
    
                renderPagination(); // í˜ì´ì§€ë„¤ì´ì…˜ ê°±ì‹ 
            }
    
            document.querySelector(".table-container").addEventListener("click", function (event) {
                if (event.target && event.target.classList.contains("remove-btn")) {
                    let bookId = event.target.dataset.bookId;
    
                    if (!confirm("ê´€ì‹¬ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    
                    fetch("toggle_interest.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: "book_id=" + bookId
                    })
                    .then(response => response.text())
                    .then(status => {
                        if (status.trim() === "deleted") {
                            bookData = bookData.filter(book => book.id !== parseInt(bookId));
                            if ((currentPage - 1) * booksPerPage >= bookData.length) {
                                currentPage = Math.max(1, currentPage - 1); // í˜„ì¬ í˜ì´ì§€ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
                            }
                            renderBooks(currentPage);
                        } else {
                            alert("ì‚­ì œ ì‹¤íŒ¨");
                        }
                    })
                    .catch(error => console.error("ìš”ì²­ ì‹¤íŒ¨:", error));
                }
            });
    
            fetchInterestBooks();
        });
    </script>
    <div class="pagination"></div>
    
        
        
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="./img/logo.png" alt="ì‚¬ì´íŠ¸ ë¡œê³ " class="logo">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="ê²€ìƒ‰...">
                <button class="search-button">ê²€ìƒ‰</button>
            </div>
            <img src="./img/mypage.jpg" alt="ë§ˆì´í˜ì´ì§€" class="mypage">
        </div>
        <div class="menu">
            <a href="Libraryloan.html">ë‚´ì„œì¬</a>
            <a href="notice.html">ê³µì§€ì‚¬í•­</a>
        </div>
        <h2>ê´€ì‹¬ ë„ì„œ ëª©ë¡</h2>
        <div class="main-content">
            <aside class="aside">
                <button onclick="window.location.href='Libraryloan.html'">ëŒ€ì¶œ ë„ì„œ</button>
                <button onclick="window.location.href='return.html'">ë°˜ë‚© ë„ì„œ</button>
                <button onclick="window.location.href='interest.html'">ê´€ì‹¬ ë„ì„œ</button>
            </aside>
            <div class="content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ë„ì„œ ì œëª©</th>
                                <th>ì €ì / ì¶œíŒì‚¬</th>
                                <th>ê´€ì‹¬ ì·¨ì†Œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody> <!-- ë™ì  ë°ì´í„° ì‚½ì… -->
                    </table>
                    <!-- ğŸ”¥ í˜ì´ì§€ë„¤ì´ì…˜ì„ í‘œ ë°”ë¡œ ì•„ë˜ë¡œ ì´ë™ -->
                    <div class="pagination"></div>  
                </div>                                
                <div class="ad-section">
                    <img src=".\img\ad1.jpg" alt="ê´‘ê³  ì´ë¯¸ì§€" class="ad-image">
                </div>
        </div>
    </div>
</body>
</html>
