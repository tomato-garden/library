<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항 페이지</title>
    <link rel="stylesheet" href="notice.css">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // 로고 클릭 시 메인화면으로 이동
            document.querySelector(".logo-placeholder").addEventListener("click", function () {
                window.location.href = "main.php"; // 메인 화면 링크로 변경
            });

            // 마이페이지 클릭 시 마이페이지로 이동
            document.querySelector(".mypage-placeholder").addEventListener("click", function () {
                window.location.href = "mypage.php"; // 마이페이지 링크로 변경
            });

            // 공지사항 클릭 시 팝업 띄우기
            document.querySelectorAll(".notice").forEach(notice => {
                notice.addEventListener("click", function () {
                    const title = this.querySelector(".notice-title").innerText;
                    const info = this.querySelector(".notice-info").innerText;

                    // 팝업 배경(오버레이) 추가
                    const overlay = document.createElement("div");
                    overlay.classList.add("overlay");

                    // 팝업 창 추가
                    const modal = document.createElement("div");
                    modal.classList.add("modal");
                    modal.innerHTML = `
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h2>${title}</h2>
                            <p>${info}</p>
                            <p>여기에 공지사항 내용이 들어갑니다.</p>
                        </div>
                    `;

                    // 팝업창을 body에 추가
                    document.body.appendChild(overlay);
                    document.body.appendChild(modal);

                    // 닫기 버튼 클릭 시 팝업 닫기
                    modal.querySelector(".close").addEventListener("click", function () {
                        modal.remove();
                        overlay.remove();
                    });

                    // 배경 클릭 시 팝업 닫기
                    overlay.addEventListener("click", function () {
                        modal.remove();
                        overlay.remove();
                    });
                });
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="./img/logo.png" alt="Logo" class="logo-placeholder">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="검색...">
                <button class="search-button">검색</button>
            </div>
            <img src="/img/mypage.jpg" alt="My Page" class="mypage-placeholder">
        </div>
        <div class="menu">
            <a href="Libraryloan.html">내서재</a>
            <a href="notice.html">공지사항</a>
        </div>
        <div class="n-container">
            <div class="content">
                <div class="buttons">
                    <h3>공지사항</h3>
                </div>
                <div class="notice-list">
                    <!-- <div class="notice">
                        <div class="notice-title">공지사항 제목 1</div>
                        <div class="notice-info">조회 123 / 댓글 4 / 추천 10 | 202x.x.x / 관리자 A</div>
                    </div>
                    <div class="notice">
                        <div class="notice-title">공지사항 제목 2</div>
                        <div class="notice-info">조회 98 / 댓글 2 / 추천 5 | 202x.x.x / 관리자 B</div>
                    </div>
                    <div class="notice">
                        <div class="notice-title">공지사항 제목 3</div>
                        <div class="notice-info">조회 200 / 댓글 8 / 추천 15 | 202x.x.x / 관리자 C</div>
                    </div>
                    <div class="notice">
                        <div class="notice-title">공지사항 제목 4</div>
                        <div class="notice-info">조회 150 / 댓글 5 / 추천 12 | 202x.x.x / 관리자 D</div>
                    </div>
                    <div class="notice">
                        <div class="notice-title">공지사항 제목 5</div>
                        <div class="notice-info">조회 75 / 댓글 1 / 추천 3 | 202x.x.x / 관리자 E</div>
                    </div> -->

                    <!-- JavaScript에서 공지사항을 동적으로 불러옴 -->

                </div>
            </div>
            <div class="ad-section">
                <img src=".\img\ad1.jpg" alt="광고 이미지" class="ad-image">
            </div>
        </div>
    </div>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    fetch("fetch_notices.php")
        .then(response => response.json())
        .then(data => {
            const noticeList = document.querySelector(".notice-list");
            noticeList.innerHTML = "";

            data.forEach(notice => {
                const noticeDiv = document.createElement("div");
                noticeDiv.classList.add("notice");

                noticeDiv.innerHTML = `
                    <div class="notice-title">${notice.title}</div>
                    <div class="notice-info">
                        조회수: <span class="notice-views" data-id="${notice.id}">${notice.view_count}</span> | 작성자: ${notice.author} | 날짜: ${notice.created_at}
                    </div>
                `;

                // 공지사항 클릭 시 조회수 증가 및 상세 보기
                noticeDiv.addEventListener("click", function () {
                    const viewSpan = noticeDiv.querySelector(".notice-views");
                    const noticeId = viewSpan.dataset.id;

                    // 조회수 증가 요청
                    fetch(`update_view.php?id=${noticeId}`)
                        .then(response => response.json())
                        .then(result => {
                            if (result.status === "success") {
                                // 조회수 UI 즉시 업데이트
                                viewSpan.textContent = parseInt(viewSpan.textContent) + 1;
                            } else {
                                console.error("조회수 업데이트 실패:", result.message);
                            }
                        })
                        .catch(error => console.error("조회수 업데이트 요청 실패:", error));

                    // 팝업 창 생성
                    const overlay = document.createElement("div");
                    overlay.classList.add("overlay");

                    const modal = document.createElement("div");
                    modal.classList.add("modal");
                    modal.innerHTML = `
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h2>${notice.title}</h2>
                            <pre class="notice-content">${notice.content}</pre> 
                        </div>
                    `;

                    document.body.appendChild(overlay);
                    document.body.appendChild(modal);

                    modal.querySelector(".close").addEventListener("click", function () {
                        modal.remove();
                        overlay.remove();
                    });

                    overlay.addEventListener("click", function () {
                        modal.remove();
                        overlay.remove();
                    });
                });

                noticeList.appendChild(noticeDiv);
            });
        })
        .catch(error => console.error("공지사항을 불러오는 중 오류 발생:", error));
});

</script>

        
</body>
</html>
